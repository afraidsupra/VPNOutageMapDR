# VPN Outage Map DR
DR script for VPN Outage Map

## What is this?

This simple python script is designed to retrieve the Outage GeoJSON file generated by ControlM using OMS data and push it to the S3 bucket used to populate the VPN Outage Map.
It should only be used in cases where Globalscape is offline.

## Requirements

For this script to work you will require;
- Access to the Outage file generated out of OMS
- Internet access with connectivity to AWS
- Details of the AWS S3 bucket that contains outage information
- IAM user account including the AWS Access Key and AWS Secret Access Key
- At least Python 3.10

## Setting up the DR environment

1) Create a folder in which you will host the script.
2) Open a Command Prompt and navigate to your desired folder.
3) Run the following commands to retrieve the required files;

```
curl https://raw.githubusercontent.com/afraidsupra/VPNOutageMapDR/refs/heads/main/main.py > main.py &
curl https://raw.githubusercontent.com/afraidsupra/VPNOutageMapDR/refs/heads/main/requirements.txt > requirements.txt
```

4) It is best practice to run in a virtual environment rather than directly from your desktop;

```
python -m venv venv &
.\venv\Scripts\activate
```

5) Once your environment is activated, install the required dependencies;

```
python -m pip install -r requirements.txt
```

## Create a variables file

You will need a variables file that contains the settings required for the script.
In your script folder, create a file called `.env`.

Your file needs the following variables defined;

```
FILENAME = <Name of the source file, most likely outages.json>
UPLOADNAME = outages.json
SOURCEDIR = \\Path\To\The\File\Generated\By\OMS\
S3BUCKETNAME = <Name of the S3 Bucket, most likely cppc-outage>
ACCESSKEY = <AWS Access Key>
SECRETKEY = <AWS Secret Access Key>
REFRESHTIME = <Refresh interval in seconds, to be agreed with business but I would suggest 300 seconds>
```

Be sure to update the variables above.

## Run the script

Once your virtual environment is created and activated and your environment variables have been defined, enabling the script is as simple as;

```
python main.py
```

## Troubleshooting

Logging, including any error messages can be found in the `refreshlog.txt` file.
